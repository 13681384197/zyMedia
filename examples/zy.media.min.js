(function(){var e={};e.config={type:"",mediaTitle:"",nativeControls:false,autoplay:false,preload:"auto",videoWidth:"100%",videoHeight:"auto",aspectRation:16/9,audioWidth:"100%",audioHeight:44,autoRewind:true,timeFormatType:1,alwaysShowHours:false,alwaysShowControls:false,hideVideoControlsOnLoad:false,enableFullscreen:true,pauseOtherPlayers:true,duration:0,success:null,error:null};(function(e){var i=window.navigator.userAgent.toLowerCase();var t=document.createElement("video");e.isiPhone=/iphone/i.test(i);e.isiOS=e.isiPhone||/ipad/i.test(i);e.isAndroid=/android/i.test(i);e.isBustedAndroid=/android 2\.[12]/i.test(i);e.isChrome=/chrome/i.test(i);e.isChromium=/chromium/i.test(i);e.hasTouch="ontouchstart"in window;e.supportsCanPlayType=typeof t.canPlayType!=="undefined";e.isVendorControls=/baidu/i.test(i);e.isVendorFullscreen=/micromessenger|weibo/i.test(i);e.isVendorAutoplay=/v819mini/i.test(i)||e.isiOS;e.nativeFullscreenPrefix=function(){if(t.requestFullScreen){return""}else if(t.webkitRequestFullScreen){return"webkit"}else if(t.mozRequestFullScreen){return"moz"}else if(t.msRequestFullScreen){return"ms"}return"-"}();e.hasOldNativeFullScreen=typeof t.webkitEnterFullscreen!=="undefined";if(e.isChrome){e.hasOldNativeFullScreen=false}if(e.hasOldNativeFullScreen&&/mac os x 10_5/i.test(i)){e.nativeFullscreenPrefix="-";e.hasOldNativeFullScreen=false}})(e.features={});function i(e,i){if(!isFinite(e)||e<0){e=0}var t=i.alwaysShowHours?[0]:[];if(Math.floor(e/3600)%24){t.push(Math.floor(e/3600)%24)}t.push(Math.floor(e/60)%60);t.push(Math.floor(e%60));t=t.join(":");if(i.timeFormatType==1){t=t.replace(/(:|^)([0-9])(?=:|$)/g,"$10$2")}return t}function t(e,i){var t=[];e.split(" ").map(function(e){t.push(e+"."+i)});return t.join(" ")}function n(){return document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen}function o(e){var i=e.substring(e.lastIndexOf(".")+1).toLowerCase();var t=/mp4|m4v|ogg|ogv|m3u8|webm|webmv|wmv|mpeg|mov/gi.test(i)?"video/":"audio/";switch(i){case"mp4":case"m4v":case"m4a":return t+"mp4";case"webm":case"webma":case"webmv":return t+"webm";case"ogg":case"oga":case"ogv":return t+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return t+"mp2t";default:return t+i}}function a(e,i){if(e&&!i){return o(e)}else{if(i&&~i.indexOf(";")){return i.substr(0,i.indexOf(";"))}else{return i}}}function s(i,t,n){var o=[];var s;var r;var l;if(t.type){if(typeof t.type=="string"){o.push({type:t.type,url:n})}else{for(s=0;s<t.type.length;s++){o.push({type:t.type[s],url:n})}}}else if(n!==null){o.push({type:a(n,i.getAttribute("type")),url:n})}else{for(s=0;s<i.childNodes.length;s++){r=i.childNodes[s];if(r.nodeType==1&&r.tagName.toLowerCase()=="source"){n=r.getAttribute("src");o.push({type:a(n,r.getAttribute("type")),url:n})}}}if(e.features.isBustedAndroid){i.canPlayType=function(e){return/video\/(mp4|m4v)/i.test(e)?"maybe":""}}if(e.features.isChromium){i.canPlayType=function(e){return/video\/(webm|ogv|ogg)/i.test(e)?"maybe":""}}if(e.features.supportsCanPlayType){for(s=0;s<o.length;s++){if(o[s].type=="video/m3u8"||i.canPlayType(o[s].type).replace(/no/,"")!==""||i.canPlayType(o[s].type.replace(/mp3/,"mpeg")).replace(/no/,"")!==""||i.canPlayType(o[s].type.replace(/m4a/,"mp4")).replace(/no/,"")!==""){l=true;break}}}return l}var r=0;e.players={};e.MediaPlayer=function(i,t){var n=this;var o;if(n.isInstantiated){return}else{n.isInstantiated=true}n.$media=$(i);n.media=i;var a=n.media.tagName.toLowerCase();if(!/audio|video/.test(a))return;n.isVideo=a==="video";n.options={};for(o in e.config){n.options[o]=e.config[o]}for(o in t){n.options[o]=t[o]}var l=n.$media.data("config");for(o in l){n.options[o]=l[o]}if(n.options.autoplay){n.options.autoplay=!e.features.isVendorAutoplay}if(!n.isVideo){n.options.alwaysShowControls=true}if(n.options.nativeControls||e.features.isVendorControls){n.$media.attr("controls","controls")}else{var d=n.media.getAttribute("src");d=typeof d=="undefined"||d===null||d==""?null:d;if(s(n.media,n.options,d)){n.id="mp_"+r++;e.players[n.id]=n;n.init()}else{alert("不支持此"+(n.isVideo?"视":"音")+"频")}}};e.MediaPlayer.prototype={isControlsVisible:true,isFullScreen:false,setPlayerSize:function(e,i){var t=this;var n=t.container.width();if(e>n){t.width=n}if(t.isVideo&&t.enableAutoSize){var o=t.media.videoWidth;var a=t.media.videoHeight;if(o&&a){if(Math.abs(t.options.aspectRation-o/a)<.1){t.options.aspectRation=o/a}}t.height=parseInt(n/t.options.aspectRation)}t.container.css({width:t.width,height:t.height});t.$media.height(t.height)},showControls:function(){var e=this;if(e.isControlsVisible)return;e.controls.css("bottom","0");if(e.options.mediaTitle){e.title.css("top","0")}e.isControlsVisible=true},hideControls:function(){var e=this;if(!e.isControlsVisible||e.options.alwaysShowControls)return;e.controls.css("bottom","-45px");if(e.options.mediaTitle){e.title.css("top","-35px")}e.isControlsVisible=false},setControlsTimer:function(e){var i=this;clearTimeout(i.controlsTimer);i.controlsTimer=setTimeout(function(){i.hideControls()},e)},updateTimeline:function(e){var i=this;var t=e!==undefined?e.target:i.media;var n=null;var o=i.slider.width();if(t.buffered&&t.buffered.length>0&&t.buffered.end&&t.duration){n=t.buffered.end(t.buffered.length-1)/t.duration}else if(t.bytesTotal!==undefined&&t.bytesTotal>0&&t.bufferedBytes!==undefined){n=t.bufferedBytes/t.bytesTotal}else if(e&&e.lengthComputable&&e.total!==0){n=e.loaded/e.total}if(n!==null){n=Math.min(1,Math.max(0,n));i.loaded.width(o*n);i.media.addEventListener("pause",function(e){setTimeout(function(){i.loaded.width(o*n);i.updateTimeline(e)},300)})}if(i.media.currentTime!==undefined&&i.media.duration){var a=Math.round(o*i.media.currentTime/i.media.duration);i.current.width(a);i.handle.css("left",a-Math.round(i.handle.width()/2))}},updateTime:function(){var e=this;e.currenttime.html(i(e.media.currentTime,e.options));if(e.options.duration>1||e.media.duration>1){e.durationD.html(i(e.options.duration>1?e.options.duration:e.media.duration,e.options))}},enterFullScreen:function(){var i=this;i.normalHeight=i.container.height();i.normalWidth=i.container.width();$(document.documentElement).addClass("zy_fullscreen");if(e.features.nativeFullscreenPrefix!="-"){i.container[0][e.features.nativeFullscreenPrefix+"RequestFullScreen"]()}else if(e.features.hasOldNativeFullScreen){i.media.webkitEnterFullscreen();return}i.container.css({width:"100%",height:"100%"});i.$media.css({width:"100%",height:"100%"});i.fullscreenBtn.addClass("zy_unfullscreen");i.isFullScreen=true},exitFullScreen:function(){var i=this;if(n()||i.isFullScreen){if(e.features.nativeFullscreenPrefix!="-"){document[e.features.nativeFullscreenPrefix+"CancelFullScreen"]()}else if(e.features.hasOldNativeFullScreen){document.webkitExitFullscreen()}}$(document.documentElement).removeClass("zy_fullscreen");i.container.css({width:i.normalWidth,height:i.normalHeight});i.$media.css({width:i.normalWidth,height:i.normalHeight});i.fullscreenBtn.removeClass("zy_unfullscreen");i.isFullScreen=false},buildContainer:function(){var e=this;e.container=e.$media.parent().css("overflow","hidden");e.container.css("height",e.isVideo?e.container.width()/e.options.aspectRation:e.options.audioHeight).html('<div class="zy_wrap"></div><div class="zy_controls"></div>');if(e.options.mediaTitle){e.title=$('<div class="zy_title">'+e.options.mediaTitle+"</div>").appendTo(e.container)}e.$media.attr("preload",e.options.preload);e.container.find(".zy_wrap").append(e.$media);e.controls=e.container.find(".zy_controls");if(e.isVideo){e.width=e.options.videoWidth;e.height=e.options.videoHeight;if(e.width=="100%"&&e.height=="auto"){e.enableAutoSize=true}e.setPlayerSize(e.width,e.height)}},buildPlaypause:function(){var e=this;var i=$('<div class="zy_playpause_btn zy_play" ></div>').appendTo(e.controls).click(function(i){e.media.isUserClick=true;if(e.media.paused){e.media.play();if(!e.media.paused&&!e.options.alwaysShowControls){e.setControlsTimer(3e3)}}else{e.media.pause()}});function t(t){if(e.media.isUserClick||e.options.autoplay){if("play"===t){i.removeClass("zy_play").addClass("zy_pause")}else{i.removeClass("zy_pause").addClass("zy_play")}}}e.media.addEventListener("play",function(){t("play")},false);e.media.addEventListener("playing",function(){t("play")},false);e.media.addEventListener("pause",function(){t("pse")},false);e.media.addEventListener("paused",function(){t("pse")},false)},buildTimeline:function(){var e=this;$('<div class="zy_timeline">'+'<div class="zy_timeline_slider">'+'<div class="zy_timeline_buffering" style="display:none"></div>'+'<div class="zy_timeline_loaded"></div>'+'<div class="zy_timeline_current"></div>'+'<div class="zy_timeline_handle"></div>'+"</div>"+"</div>").appendTo(e.controls);e.slider=e.controls.find(".zy_timeline_slider");e.loaded=e.controls.find(".zy_timeline_loaded");e.current=e.controls.find(".zy_timeline_current");e.handle=e.controls.find(".zy_timeline_handle");e.buffering=e.controls.find(".zy_timeline_buffering");var i=false;var t=e.slider.offset().left;var n=e.slider.width();var o=function(o){var a=0;var s;if(o.changedTouches){s=o.changedTouches[0].pageX}else{s=o.pageX}if(e.media.duration){if(s<t){s=t}else if(s>n+t){s=n+t}a=(s-t)/n*e.media.duration;if(i&&a!==e.media.currentTime){e.media.currentTime=a}}};e.slider.on("mousedown touchstart",function(a){i=true;o(a);t=e.slider.offset().left;n=e.slider.width();e.globalBind("mousemove.dur touchmove.dur",function(e){o(e)});e.globalBind("mouseup.dur touchend.dur",function(t){i=false;e.globalUnbind(".dur")})}).on("mouseenter",function(i){e.globalBind("mousemove.dur",function(e){o(e)})}).on("mouseleave",function(t){if(!i){e.globalUnbind(".dur")}});e.media.addEventListener("progress",function(i){e.updateTimeline(i)},false);e.media.addEventListener("timeupdate",function(i){e.updateTimeline(i)},false)},buildTime:function(){var e=this;$('<div class="zy_time">'+'<span class="zy_currenttime">'+i(0,e.options)+"</span>/"+'<span class="zy_duration">'+i(e.options.duration,e.options)+"</span>"+"</div>").appendTo(e.controls);e.currenttime=e.controls.find(".zy_currenttime");e.durationD=e.controls.find(".zy_duration");e.media.addEventListener("timeupdate",function(){e.updateTime()},false)},buildFullscreen:function(){var i=this;if(e.features.nativeFullscreenPrefix!="-"){var t=function(e){if(i.isFullScreen){if(!n()){i.exitFullScreen()}}};i.globalBind(e.features.nativeFullscreenPrefix+"fullscreenchange",t)}i.fullscreenBtn=$('<div class="zy_fullscreen_btn"></div>').appendTo(i.controls);i.fullscreenBtn.click(function(){if(e.features.nativeFullscreenPrefix!="-"&&n()||i.isFullScreen){i.exitFullScreen()}else{i.enterFullScreen()}})},buildDec:function(){var i=this;var t=$('<div class="dec_loading"></div>').hide().appendTo(i.container);var n=$('<div class="dec_error">播放异常</div>').hide().appendTo(i.container);var o=$();if(!e.features.isiPhone){o=$('<div class="dec_play"></div>').appendTo(i.container).on("click",function(){i.media.isUserClick=true;if(i.media.paused){i.media.play();if(!i.media.paused&&!i.options.alwaysShowControls){i.setControlsTimer(3e3)}}})}i.media.addEventListener("play",function(){if(i.media.isUserClick){o.hide();t.show();i.buffering.hide();n.hide()}},false);i.media.addEventListener("playing",function(){o.hide();t.hide();i.buffering.hide();n.hide()},false);i.media.addEventListener("seeking",function(){t.show();o.hide();i.buffering.show()},false);i.media.addEventListener("seeked",function(){t.hide();i.buffering.hide()},false);i.media.addEventListener("pause",function(){if(!e.features.isiPhone){o.show()}},false);i.media.addEventListener("waiting",function(){t.show();o.hide();i.buffering.show()},false);i.media.addEventListener("error",function(e){t.hide();o.show();i.media.pause();n.show();i.buffering.hide();if(typeof i.options.error=="function"){i.options.error(e)}},false)},globalBind:function(e,i){$(document).on(t(e,this.id),i)},globalUnbind:function(e,i){$(document).off(t(e,this.id),i)},init:function(){var i=this;var t=["Container","Playpause","Timeline","Time"];if(i.options.enableFullscreen&&!e.features.isVendorFullscreen&&i.isVideo){t.push("Fullscreen")}if(i.isVideo){t.push("Dec")}for(var n=0;n<t.length;n++){try{i["build"+t[n]]()}catch(o){}}if(i.isVideo){if(e.features.hasTouch){i.media.addEventListener("click",function(){if(i.isControlsVisible){i.hideControls()}else{i.showControls();if(!i.media.paused&&!i.options.alwaysShowControls){i.setControlsTimer(3e3)}}},false)}else{i.media.addEventListener("click",function(){if(i.media.paused){i.media.play()}else{i.media.pause()}},false);i.container.on("mouseenter",function(){i.showControls();if(!i.options.alwaysShowControls){i.setControlsTimer(3e3)}}).on("mousemove",function(){i.showControls();if(!i.options.alwaysShowControls){i.setControlsTimer(3e3)}}).on("mouseleave",function(){if(!i.media.paused&&!i.options.alwaysShowControls){i.setControlsTimer(3e3)}})}if(i.options.hideVideoControlsOnLoad){i.hideControls()}i.media.addEventListener("loadedmetadata",function(e){if(i.enableAutoSize){setTimeout(function(){if(!isNaN(i.media.videoHeight)){i.setPlayerSize()}},50)}},false);i.media.addEventListener("play",function(){var t;for(var n in e.players){t=e.players[n];if(t.id!=i.id&&i.options.pauseOtherPlayers&&!t.paused&&!t.ended){try{t.media.pause()}catch(o){}}}},false)}window.addEventListener("orientationchange",function(){setTimeout(function(){i.setPlayerSize()},500)});i.media.addEventListener("ended",function(e){if(i.options.autoRewind){try{i.media.currentTime=0;setTimeout(function(){$(i.container).find(".dec_loading").hide()},20)}catch(t){}}i.media.pause();i.updateTimeline(e)},false);i.media.addEventListener("loadedmetadata",function(e){i.updateTime()},false);if(i.options.autoplay){i.media.isUserClick=false;i.media.play()}if(typeof i.options.success=="function"){i.options.success(i.media)}}};$.fn.mediaplayer=function(i){this.each(function(){new e.MediaPlayer(this,i)});return this}})();