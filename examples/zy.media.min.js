var zyMedia={};zyMedia.config={type:"",mediaTitle:"",nativeControls:false,autoplay:false,preload:"auto",videoWidth:"100%",videoHeight:"auto",aspectRation:16/9,audioWidth:"100%",audioHeight:44,autoRewind:true,timeFormat:1,alwaysShowHours:false,alwaysShowControls:false,hideVideoControlsOnLoad:false,enableFullscreen:true,pauseOtherPlayers:true,duration:0,timeAndDurationSeparator:"<span>/</span>",success:null,error:function(){}};zyMedia.timeFormat=function(e,i){if(!isFinite(e)||e<0){e=0}var t=i.alwaysShowHours?[0]:[];if(Math.floor(e/3600)%24){t.push(Math.floor(e/3600)%24)}t.push(Math.floor(e/60)%60);t.push(Math.floor(e%60));t=t.join(":");if(i.timeFormat==1){t=t.replace(/(:|^)([0-9])(?=:|$)/g,"$10$2")}return t};(function(){var e=zyMedia.features={};var i=window.navigator.userAgent.toLowerCase();var t=document.createElement("video");e.isiPhone=/iphone/i.test(i);e.isiOS=e.isiPhone||/ipad/i.test(i);e.isAndroid=/android/i.test(i);e.isBustedAndroid=/android 2\.[12]/i.test(i);e.isChrome=/chrome/i.test(i);e.isChromium=/chromium/i.test(i);e.hasTouch="ontouchstart"in window;e.supportsMediaTag=typeof t.canPlayType!=="undefined"||e.isBustedAndroid;e.isVendor=/baidu/i.test(i);e.isVendorFullscreen=/micromessenger|weibo/i.test(i);e.isVendorAutoplay=/v819mini/i.test(i)||e.isiOS;e.hasSemiNativeFullScreen=typeof t.webkitEnterFullscreen!=="undefined";e.hasNativeFullscreen=typeof t.requestFullscreen!=="undefined";e.hasWebkitNativeFullScreen=typeof t.webkitRequestFullScreen!=="undefined";e.hasMozNativeFullScreen=typeof t.mozRequestFullScreen!=="undefined";e.hasMsNativeFullScreen=typeof t.msRequestFullscreen!=="undefined";e.hasTrueNativeFullScreen=e.hasWebkitNativeFullScreen||e.hasMozNativeFullScreen||e.hasMsNativeFullScreen;e.nativeFullScreenEnabled=e.hasTrueNativeFullScreen;if(e.hasMozNativeFullScreen){e.nativeFullScreenEnabled=document.mozFullScreenEnabled}else if(e.hasMsNativeFullScreen){e.nativeFullScreenEnabled=document.msFullscreenEnabled}if(e.isChrome){e.hasSemiNativeFullScreen=false}if(e.hasTrueNativeFullScreen){e.fullScreenEventName="";if(e.hasWebkitNativeFullScreen){e.fullScreenEventName="webkitfullscreenchange"}else if(e.hasMozNativeFullScreen){e.fullScreenEventName="mozfullscreenchange"}e.isFullScreen=function(){if(e.hasMozNativeFullScreen){return document.mozFullScreen}else if(e.hasWebkitNativeFullScreen){return document.webkitIsFullScreen}};e.requestFullScreen=function(i){if(e.hasWebkitNativeFullScreen){i.webkitRequestFullScreen()}else if(e.hasMozNativeFullScreen){i.mozRequestFullScreen()}};e.cancelFullScreen=function(){if(e.hasWebkitNativeFullScreen){document.webkitCancelFullScreen()}else if(e.hasMozNativeFullScreen){document.mozCancelFullScreen()}}}if(e.hasSemiNativeFullScreen&&/mac os x 10_5/i.test(i)){e.hasNativeFullScreen=false;e.hasSemiNativeFullScreen=false}})();zyMedia.mediaShim={create:function(e,i){var t=e.tagName.toLowerCase();var n=t==="audio"||t==="video";var a=n?e.getAttribute("src"):e.getAttribute("href");var r;a=typeof a=="undefined"||a===null||a==""?null:a;r=this.determinePlayback(e,i,zyMedia.features.supportsMediaTag,n,a);r.url=r.url!==null?r.url:"";if(r.method=="native"){if(zyMedia.features.isBustedAndroid){e.src=r.url;e.addEventListener("click",function(){e.play()},false)}this.updateNative(r,i)}else{alert("不支持HTML5"+(t=="video"?"视":"音")+"频");return this}},determinePlayback:function(e,i,t,n,a){var r=[];var o;var s;var l={method:"",url:"",mediaPlayer:e,isVideo:e.tagName.toLowerCase()==="video"};var d;if(typeof i.type!="undefined"&&i.type!==""){if(typeof i.type=="string"){r.push({type:i.type,url:a})}else{for(o=0;o<i.type.length;o++){r.push({type:i.type[o],url:a})}}}else if(a!==null){r.push({type:this.formatType(a,e.getAttribute("type")),url:a})}else{for(o=0;o<e.childNodes.length;o++){s=e.childNodes[o];if(s.nodeType==1&&s.tagName.toLowerCase()=="source"){a=s.getAttribute("src");var u=s.getAttribute("media");if(!u||!window.matchMedia||window.matchMedia&&window.matchMedia(u).matches){r.push({type:this.formatType(a,s.getAttribute("type")),url:a})}}}}if(!n&&r.length>0&&r[0].url!==null&&this.getTypeFromFile(r[0].url).indexOf("audio")>-1){l.isVideo=false}if(zyMedia.features.isBustedAndroid){e.canPlayType=function(e){return/video\/(mp4|m4v)/i.test(e)?"maybe":""}}if(zyMedia.features.isChromium){e.canPlayType=function(e){return/video\/(webm|ogv|ogg)/i.test(e)?"maybe":""}}if(t){if(!n){d=document.createElement(l.isVideo?"video":"audio");e.parentNode.insertBefore(d,e);e.style.display="none";l.mediaPlayer=e=d}for(o=0;o<r.length;o++){if(r[o].type=="video/m3u8"||e.canPlayType(r[o].type).replace(/no/,"")!==""||e.canPlayType(r[o].type.replace(/mp3/,"mpeg")).replace(/no/,"")!==""||e.canPlayType(r[o].type.replace(/m4a/,"mp4")).replace(/no/,"")!==""){l.method="native";l.url=r[o].url;break}}if(l.method==="native"){if(l.url!==null){e.src=l.url}return l}}if(l.method===""&&r.length>0){l.url=r[0].url}return l},formatType:function(e,i){if(e&&!i){return this.getTypeFromFile(e)}else{if(i&&~i.indexOf(";")){return i.substr(0,i.indexOf(";"))}else{return i}}},getTypeFromFile:function(e){e=e.split("?")[0];var i=e.substring(e.lastIndexOf(".")+1).toLowerCase();var t=/(mp4|m4v|ogg|ogv|m3u8|webm|webmv|wmv|mpeg|mov)/gi.test(i)?"video/":"audio/";return this.getTypeFromExtension(i,t)},getTypeFromExtension:function(e,i){i=i||"";switch(e){case"mp4":case"m4v":case"m4a":return i+"mp4";case"webm":case"webma":case"webmv":return i+"webm";case"ogg":case"oga":case"ogv":return i+"ogg";case"m3u8":return"application/x-mpegurl";case"ts":return i+"mp2t";default:return i+e}},updateNative:function(e,i){var t=e.mediaPlayer;t.isFullScreen=false;t.setCurrentTime=function(e){this.currentTime=e};i.shimSuccess(t)}};(function(){zyMedia.mpIndex=0;zyMedia.players={};zyMedia.MediaPlayer=function(e,i){var t=this;var n;if(!(t instanceof zyMedia.MediaPlayer)){return new zyMedia.MediaPlayer(e,i)}if(!e){return}t.$media=$(e);t.media=e;if(typeof t.media.player!="undefined"){return t.media.player}t.options={};for(n in zyMedia.config){t.options[n]=zyMedia.config[n]}for(n in i){t.options[n]=i[n]}var a=t.$media.data("config");for(n in a){t.options[n]=a[n]}if(t.options.autoplay){t.options.autoplay=!zyMedia.features.isVendorAutoplay}t.id="mp_"+zyMedia.mpIndex++;zyMedia.players[t.id]=t;t.init();return t};zyMedia.MediaPlayer.prototype={hasFocus:false,controlsAreVisible:true,init:function(){var e=this;e.isVideo=e.media.tagName.toLowerCase()==="video";if(!e.isVideo){e.options.alwaysShowControls=true}if(zyMedia.features.isiOS&&(e.options.nativeControls||zyMedia.features.isVendor)){e.$media.attr("controls","controls")}else if(zyMedia.features.isAndroid&&(e.options.nativeControls||zyMedia.features.isVendor)){e.$media.attr("controls","controls")}else{e.options.shimSuccess=function(i){e.meReady(i)};zyMedia.mediaShim.create(e.media,e.options)}},showControls:function(){var e=this;if(e.controlsAreVisible)return;e.controls.css("bottom","0");if(e.options.mediaTitle){e.title.css("top","0")}e.controlsAreVisible=true},hideControls:function(){var e=this;if(!e.controlsAreVisible||e.options.alwaysShowControls)return;e.controls.css("bottom","-45px");if(e.options.mediaTitle){e.title.css("top","-35px")}e.controlsAreVisible=false},controlsTimer:null,startControlsTimer:function(e){var i=this;e=e||1500;i.killControlsTimer();i.controlsTimer=setTimeout(function(){i.hideControls();i.killControlsTimer()},e)},killControlsTimer:function(){var e=this;if(e.controlsTimer!==null){clearTimeout(e.controlsTimer);delete e.controlsTimer;e.controlsTimer=null}},meReady:function(e){var i=this;if(i.created){return}else{i.created=true}i.container=i.$media.parent();if(i.isVideo){i.container.css("height",i.container.width()/i.options.aspectRation)}else{i.container.css("height",i.options.audioHeight)}i.container.html('<div class="zy_wrap"></div>'+'<div class="zy_controls"></div>').addClass(i.media.className).attr("id",i.id).focus(function(e){if(!i.controlsAreVisible){i.showControls()}});if(i.options.mediaTitle){i.title=$('<div class="zy_title">'+i.options.mediaTitle+"</div>").appendTo(i.container)}i.container.find(".zy_wrap").append(i.$media);i.$media.attr("preload",i.options.preload);i.media.player=i;i.controls=i.container.find(".zy_controls");if(i.isVideo){i.width=i.options.videoWidth;i.height=i.options.videoHeight;if(i.width=="100%"&&i.height=="auto"){i.enableAutoSize=true}i.setPlayerSize(i.width,i.height)}i.buildmain(i,i.controls,i.media);var t=["playpause","current","progress","duration"];if(i.options.enableFullscreen&&!zyMedia.features.isVendorFullscreen){t.push("fullscreen")}for(var n in t){feature=t[n];if(i["build"+feature]){try{i["build"+feature](i,i.controls,i.media)}catch(a){}}}if(i.isVideo){if(zyMedia.features.hasTouch){i.media.addEventListener("touchstart",function(){if(i.controlsAreVisible){i.hideControls()}else{i.showControls();if(!i.media.paused&&!i.options.alwaysShowControls){i.startControlsTimer(3e3)}}},false)}else{i.media.addEventListener("click",function(){if(i.media.paused){i.play()}else{i.pause()}},false);i.container.on("mouseenter",function(){if(!i.options.alwaysShowControls){i.killControlsTimer();i.showControls();i.startControlsTimer(2500)}}).on("mousemove",function(){if(!i.controlsAreVisible){i.showControls()}if(!i.options.alwaysShowControls){i.startControlsTimer(2500)}}).on("mouseleave",function(){if(!i.media.paused&&!i.options.alwaysShowControls){i.startControlsTimer(1e3)}})}if(i.options.hideVideoControlsOnLoad){i.hideControls()}i.media.addEventListener("loadedmetadata",function(e){if(i.enableAutoSize){setTimeout(function(){if(!isNaN(i.media.videoHeight)){i.setPlayerSize()}},50)}},false);e.addEventListener("play",function(){var e;for(var t in zyMedia.players){e=zyMedia.players[t];if(e.id!=i.id&&i.options.pauseOtherPlayers&&!e.paused&&!e.ended){e.pause()}e.hasFocus=false}i.hasFocus=true},false)}window.addEventListener("orientationchange",function(){setTimeout(function(){i.setPlayerSize()},500)});i.media.addEventListener("ended",function(e){if(i.options.autoRewind){try{i.media.setCurrentTime(0);setTimeout(function(){$(i.container).find(".dec_loading").hide()},20)}catch(t){}}i.media.pause();if(i.setProgressRail){i.setProgressRail()}if(i.setCurrentRail){i.setCurrentRail()}if(!i.options.alwaysShowControls){i.showControls()}},false);i.media.addEventListener("loadedmetadata",function(e){if(i.updateDuration){i.updateDuration()}if(i.updateCurrent){i.updateCurrent()}},false);if(i.options.autoplay){i.media.isUserClick=false;i.play()}if(typeof i.options.success=="function"){i.options.success(i.media)}},handleError:function(e){var i=this;if(i.controls){i.controls.css("bottom","-45px")}if(i.options.error){i.options.error(e)}},setPlayerSize:function(e,i){var t=this;var n=t.container.width();if(e>n){t.width=n}if(t.isVideo&&t.enableAutoSize){var a=t.media.videoWidth;var r=t.media.videoHeight;if(a&&r){if(Math.abs(t.options.aspectRation-a/r)<.1){t.options.aspectRation=a/r}}t.height=parseInt(n/t.options.aspectRation,10)}t.container.width(t.width);t.container.height(t.height);t.$media.height(t.height)},buildmain:function(e,i,t){var n=this;if(!e.isVideo)return;var a=$('<div class="dec_loading"></div>').hide().appendTo(e.container);var r=$('<div class="dec_error">播放异常</div>').hide().appendTo(e.container);var o=$();if(!zyMedia.features.isiPhone){o=$('<div class="dec_play"></div>').appendTo(e.container).on("click",function(){t.isUserClick=true;if(t.paused){t.play();if(!n.media.paused&&!n.options.alwaysShowControls){n.startControlsTimer(3e3)}}})}t.addEventListener("play",function(){if(t.isUserClick){o.hide();a.show();i.find(".zy_time_buffering").hide();r.hide()}},false);t.addEventListener("playing",function(){o.hide();a.hide();i.find(".zy_time_buffering").hide();r.hide()},false);t.addEventListener("seeking",function(){a.show();o.hide();i.find(".zy_time_buffering").show()},false);t.addEventListener("seeked",function(){a.hide();i.find(".zy_time_buffering").hide()},false);t.addEventListener("pause",function(){if(!zyMedia.features.isiPhone){o.show()}},false);t.addEventListener("waiting",function(){a.show();o.hide();i.find(".zy_time_buffering").show()},false);t.addEventListener("error",function(e){n.handleError(e);a.hide();o.show();t.pause();r.show();i.find(".zy_time_buffering").hide()},false)},play:function(){this.load();this.media.play()},pause:function(){try{this.media.pause()}catch(e){}},load:function(){if(!this.isLoaded){this.media.load()}this.isLoaded=true},setCurrentTime:function(e){this.media.currentTime=e},getCurrentTime:function(){return this.media.currentTime},remove:function(){var e=this;var i;e.container.prev(".zy_offscreen").remove();for(var t in e.options.features){i=e.options.features[t];if(e["clean"+i]){try{e["clean"+i](e)}catch(n){}}}if(!e.isDynamic){e.$media.prop("controls",true);e.$media.clone().insertBefore(e.container).show();e.$media.remove()}else{e.$media.insertBefore(e.container)}delete zy.players[e.id];e.container.remove();e.globalUnbind();delete e.media.player}};var e=/^((after|before)print|(before)?unload|hashchange|message|o(ff|n)line|page(hide|show)|popstate|storage)\b/;function i(i,t){var n={d:[],w:[]};$.each((i||"").split(" "),function(i,a){var r=a+"."+t;if(r.indexOf(".")===0){n.d.push(r);n.w.push(r)}else{n[e.test(a)?"w":"d"].push(r)}});n.d=n.d.join(" ");n.w=n.w.join(" ");return n}zyMedia.MediaPlayer.prototype.globalBind=function(e,t,n){e=i(e,this.id);if(e.d)$(document).on(e.d,t,n);if(e.w)$(window).on(e.w,t,n)};zyMedia.MediaPlayer.prototype.globalUnbind=function(e,t){e=i(e,this.id);if(e.d)$(document).off(e.d,t);if(e.w)$(window).off(e.w,t)};$.fn.mediaplayer=function(e){this.each(function(){new zyMedia.MediaPlayer(this,e)});return this};$.extend(zyMedia.MediaPlayer.prototype,{buildplaypause:function(e,i,t){var n=this;var a=$('<div class="zy_playpause_button zy_play" ></div>').appendTo(i).click(function(e){e.preventDefault();t.isUserClick=true;if(t.paused){t.play();if(!n.media.paused&&!n.options.alwaysShowControls){n.startControlsTimer(3e3)}}else{t.pause()}return false});function r(e){if(t.isUserClick||n.options.autoplay){if("play"===e){a.removeClass("zy_play").addClass("zy_pause")}else{a.removeClass("zy_pause").addClass("zy_play")}}}t.addEventListener("play",function(){r("play")},false);t.addEventListener("playing",function(){r("play")},false);t.addEventListener("pause",function(){r("pse")},false);t.addEventListener("paused",function(){r("pse")},false)},buildprogress:function(e,i,t){$('<div class="zy_time_rail">'+'<span class="zy_time_total zy_time_slider">'+'<span class="zy_time_buffering"></span>'+'<span class="zy_time_loaded"></span>'+'<span class="zy_time_current"></span>'+'<span class="zy_time_handle"></span>'+"</span>"+"</div>").insertBefore(i.find(".zy_time"));i.find(".zy_time_buffering").hide();var n=this;var a=i.find(".zy_time_total");var r=i.find(".zy_time_loaded");var o=i.find(".zy_time_current");var s=i.find(".zy_time_handle");var l=i.find(".zy_time_slider");var d=function(e){var i=a.offset(),n=a.width(),r=0,o=0,s=0,l;if(e.originalEvent&&e.originalEvent.changedTouches){l=e.originalEvent.changedTouches[0].pageX}else if(e.changedTouches){l=e.changedTouches[0].pageX}else{l=e.pageX}if(t.duration){if(l<i.left){l=i.left}else if(l>n+i.left){l=n+i.left}s=l-i.left;r=s/n;o=r<=.02?0:r*t.duration;if(u&&o!==t.currentTime){t.setCurrentTime(o)}}};var u=false;var c=false;var f=false;n.loaded=r;n.total=a;n.current=o;n.handle=s;a.on("mousedown touchstart",function(e){if(e.which===1||e.which===0){u=true;d(e);n.globalBind("mousemove.dur touchmove.dur",function(e){d(e)});n.globalBind("mouseup.dur touchend.dur",function(e){u=false;n.globalUnbind(".dur")})}}).on("mouseenter",function(e){c=true;n.globalBind("mousemove.dur",function(e){d(e)})}).on("mouseleave",function(e){c=false;if(!u){n.globalUnbind(".dur")}});t.addEventListener("progress",function(i){e.setProgressRail(i);e.setCurrentRail(i)},false);t.addEventListener("timeupdate",function(i){e.setProgressRail(i);e.setCurrentRail(i)},false)},setProgressRail:function(e){var i=this;var t=e!==undefined?e.target:i.media;var n=null;if(t&&t.buffered&&t.buffered.length>0&&t.buffered.end&&t.duration){n=t.buffered.end(t.buffered.length-1)/t.duration}else if(t&&t.bytesTotal!==undefined&&t.bytesTotal>0&&t.bufferedBytes!==undefined){n=t.bufferedBytes/t.bytesTotal}else if(e&&e.lengthComputable&&e.total!==0){n=e.loaded/e.total}if(n!==null){n=Math.min(1,Math.max(0,n));i.loaded.width(i.total.width()*n);i.media.addEventListener("pause",function(){setTimeout(function(){i.loaded.width(i.total.width()*n);i.setCurrentRail()},300)})}},setCurrentRail:function(){var e=this;if(e.media.currentTime!==undefined&&e.media.duration){var i=Math.round(e.total.width()*e.media.currentTime/e.media.duration);var t=i-Math.round(e.handle.width()/2);e.current.width(i);e.handle.css("left",t)}},buildcurrent:function(e,i,t){var n=this;$('<div class="zy_time">'+'<span class="zy_currenttime">'+zyMedia.timeFormat(0,e.options)+"</span>"+"</div>").appendTo(i);n.currenttime=n.controls.find(".zy_currenttime");t.addEventListener("timeupdate",function(){e.updateCurrent()},false)},buildduration:function(e,i,t){var n=this;if(i.children().last().find(".zy_currenttime").length>0){$(n.options.timeAndDurationSeparator+'<span class="zy_duration">'+zyMedia.timeFormat(n.options.duration,n.options)+"</span>").appendTo(i.find(".zy_time"))}else{i.find(".zy_currenttime").parent().addClass("zy_currenttime_container");$('<div class="zy_time zy_duration_container">'+'<span class="zy_duration">'+zyMedia.timeFormat(n.options.duration,n.options)+"</span>"+"</div>").appendTo(i)}n.durationD=n.controls.find(".zy_duration");t.addEventListener("timeupdate",function(){e.updateDuration()},false)},updateCurrent:function(){var e=this;e.currenttime.html(zyMedia.timeFormat(e.media.currentTime,e.options))},updateDuration:function(){var e=this;if(e.options.duration>1||e.media.duration>1){e.durationD.html(zyMedia.timeFormat(e.options.duration>1?e.options.duration:e.media.duration,e.options))}},isFullScreen:false,buildfullscreen:function(e,i,t){if(!e.isVideo)return;if(zyMedia.features.hasTrueNativeFullScreen){var n=function(i){if(e.isFullScreen){if(!zyMedia.features.isFullScreen()){e.exitFullScreen()}}};e.globalBind(zyMedia.features.fullScreenEventName,n)}e.fullscreenBtn=$('<div class="zy_fullscreen_button"></div>').appendTo(i);e.fullscreenBtn.click(function(){if(zyMedia.features.hasTrueNativeFullScreen&&zyMedia.features.isFullScreen()||e.isFullScreen){e.exitFullScreen()}else{e.enterFullScreen()}});this.normalHeight=0;this.normalWidth=0},cleanfullscreen:function(e){e.exitFullScreen()},containerSizeTimeout:null,enterFullScreen:function(){var e=this;e.normalHeight=e.container.height();e.normalWidth=e.container.width();$(document.documentElement).addClass("zy_fullscreen");if(zyMedia.features.hasTrueNativeFullScreen){zyMedia.features.requestFullScreen(e.container[0])}else if(zyMedia.features.hasSemiNativeFullScreen){e.media.webkitEnterFullscreen();return}e.container.width("100%").height("100%");e.containerSizeTimeout=setTimeout(function(){e.container.css({width:"100%",height:"100%"})},500);e.$media.width("100%").height("100%");e.fullscreenBtn.removeClass("zy_fullscreen").addClass("zy_unfullscreen");e.isFullScreen=true},exitFullScreen:function(){var e=this;clearTimeout(e.containerSizeTimeout);if(zyMedia.features.hasTrueNativeFullScreen&&(zyMedia.features.isFullScreen()||e.isFullScreen)){zyMedia.features.cancelFullScreen()}$(document.documentElement).removeClass("zy_fullscreen");e.container.width(e.normalWidth).height(e.normalHeight);e.$media.width(e.normalWidth).height(e.normalHeight);e.fullscreenBtn.removeClass("zy_unfullscreen").addClass("zy_fullscreen");e.isFullScreen=false}})})();